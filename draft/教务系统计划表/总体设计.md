# 总体设计


## 实现功能：
* [x] 修改密码
* [x] 课程班人数限制
* [x] tooltip  鼠标悬浮提示
* [x] 筛选、排序、搜索
* [ ] 实时刷新同步数据库
* [ ] 夜间模式切换
* [ ] 导入专业、学生、课程
* [ ] 注册机+注册码
* [ ] qprogressdialog 线程进度条
* [ ] 网页端设计  -- http可访问

## 今日任务
* [ ] qsqltablemodel  管理界面
* [ ] 日间模式
* [ ] 导入



## 采用技术
* [ ] widgetstack + buttongroup
* [ ] proxyFilter


## 重写接口
* [x] qsqlQueryModel
* [ ] qdialog 密码修改对话框

## 自定义框架
* [x] 验证码
* [ ] 标题边框
* [ ] diy窗口


## 分类计算

### 分配选课班
 加入学生时，令 m=(((cid * 1000) + majid) * 10 + phase) 判断 查找大于m\*100，小于(m+1)\*100的降序，令m=它的selectid, 搜第一个班级的人数，小于90人，则加入，反之 m+1 加入 

### 课程性质 代码   (专业大类(学科)、具体专业、必修/选修)
通选课  公共必修课    学科必修课       学科选修课    专业必修课    专业选修课    跨专业选课
000         001               101                    100              111               110             010
0               1                   4                       3                  6                  5                   2

### 学生id
根据学生专业、入学年份、学生名字排序计算id
id = row_num + enrol * 1000000 + majid * 1000

### 分专业班级
根据学生专业、入学年份、学生id 进行分班
sclass = enrol * 10000 + majid * 100 + FLOOR(id % 1000 /  45 +1)


### 获取学生学期阶段
根据当前年份、月份和入学年份计算
phase = 0;
phase += (time.year - enrol)*2;
phase += time.month > 8 ? 1 : 0;




## 学生：
* [x] 课程查询
    * 全部课程
    * 当前课程
    * 课程计划
* [x] 选课查讯 -- 根据现在时间和入学年份计算学期
    * 未选课程
    * 已选课程
* [ ] 成绩查询
    * 成绩显示
    * 统计(完成课程数、总分、平均分)   // 动态筛选存在bug
    * 专业排名（待完成...）
    * 班级排名
* [ ] 课表查询
* 课程表(待议)




## 教师
开设课程 -> 课程班级 -> 管理学生;   (双击切换界面、按钮设置颜色) 
表单悬停变色、显示tooltip QStyledItemDelegate


* [x] 学生管理
    * [x] 管理班级
    * [x] 成绩录入
* [x] 课程管理
    * [x] 开设课程
    * [x] 我的课程

## 管理
提示： handler 存储过程中加入事务、 一次性删除时


## 数据表设计
* [x] 学生
* [x] 教师
* [x] 管理
* [x] 选课
* [x] 专业
* [x] 课程表
* [x] 班级表
* [ ] 时间课程表







## 遇到的BUG记录
QComboBox 的 additem函数 不能跟while 联用，需要使用for  qsqlquery.value